# PRÁCTICA 1 - CONFIGURACIÓN NFS

# Servidor NFS
sudo apt install nfs-kernel-server -y
mkdir OS3
cd OS3
ls
touch ADRIAN{1..100}.txt
sudo nano /etc/exports
sudo exportfs -a
df -h
sudo systemctl restart nfs-kernel-server
pwd

# Cliente NFS
sudo apt install nfs-common -y
mkdir CARPETA_DESTINO
sudo mount 192.168.100.57:/home/miguel/OS3 /home/sistema3/CARPETA_DESTINO
ls CARPETA_DESTINO
cd CARPETA_DESTINO
nano ADRIAN99.txt

# Servidor - Verificación
cat ADRIAN99.txt
sudo nano /etc/fstab
df -h
sudo reboot
df -h

# PRÁCTICA 2 - CONFIGURACIÓN SAMBA

# Servidor Samba
sudo apt install samba -y
adduser samba
addgroup sistema3
usermod -aG sistema3 samba
smbpasswd -a samba
smbpasswd -e samba
mkdir /home/samba/compartida_samba
cd /home/samba
ls -l
chown -R root:sistema3 compartida_samba
chmod -R 777 compartida_samba
touch compartida_samba/ADRIAN{1..100}.txt
ls
sudo nano /etc/samba/smb.conf
sudo systemctl restart smbd

# Cliente Samba
# Acceder desde explorador: \\192.168.100.57
chown -R root:sistema3 compartida_samba
chmod -R 777 compartida_samba
cat /home/samba/compartida_samba

# PRÁCTICA 3 - DOMAIN CONTROLLER

# Actualizar sistema
sudo apt update && sudo apt upgrade -y

# Configurar hostname
sudo hostnamectl set-hostname dc01.miguel.local

# Verificar hostname
hostname

# Identificar adaptador de red
ip link show | grep "state UP" | awk -F: '{print $2}' | tr -d ' '

# Configurar netplan
sudo nano /etc/netplan/00-installer-config.yaml
sudo netplan apply

# Configurar hosts
sudo nano /etc/hosts
# Agregar:
# 127.0.0.1 localhost
# 192.168.100.10 dc01.miguel.local dc01

# Solución para errores de DNS
sudo systemctl stop systemd-resolved
sudo systemctl disable systemd-resolved
sudo systemctl mask systemd-resolved
sudo rm -f /etc/resolv.conf
sudo touch /etc/resolv.conf
sudo chmod 644 /etc/resolv.conf
sudo nano /etc/resolv.conf
# Escribir:
# nameserver 8.8.8.8
# nameserver 1.1.1.1

# Instalar paquetes necesarios
sudo apt install -y samba samba-ad-dc smbclient winbind libnss-winbind libpam-winbind krb5-user krb5-config dnsutils

# Eliminar posibles conflictos
sudo apt remove --purge bind9 bind9utils -y
sudo pkill -9 named
sudo pkill -9 dnsmasq

# Verificar puerto 53 libre
sudo ss -tulpn | grep :53

# Configurar Kerberos
sudo cp /var/lib/samba/private/krb5.conf /etc/krb5.conf

# Configurar DNS definitivo
sudo nano /etc/resolv.conf
# Escribir:
# nameserver 127.0.0.1
# nameserver 8.8.8.8
# search miguel.local
# domain miguel.local

# Hacer inmutable para evitar cambios
sudo chattr +i /etc/resolv.conf

# Iniciar servicios
sudo systemctl enable samba-ad-dc
sudo systemctl start samba-ad-dc

# REINICIAR LA MÁQUINA
sudo reboot

# Verificar estado después del reinicio
sudo systemctl status samba-ad-dc

# Verificar DNS
nslookup miguel.local
nslookup dc01.miguel.local

# Verificar Kerberos
kinit Administrator@MIGUEL.LOCAL
# Contraseña: AdminPassword123!
klist

# Verificar usuarios
sudo samba-tool user list

# Información del dominio
sudo samba-tool domain info 127.0.0.1

# Para unir equipos Windows al dominio usar:
# Add-Computer -DomainName "MIGUEL.LOCAL" -Credential